{
  "directive": "You are to implement the unified P2P geo-broadcast system for G3ZKP Messenger as specified. Execute the following tasks in order, providing verification output after each.",

  "project_context": {
    "goal": "Implement three features using the same SignedGeoReport pattern: 1) Hazard Reports, 2) Live Traffic Data, 3) QR-Verified Business Reviews.",
    "principles": [
      "All data is signed, broadcast via libp2p Gossipsub, and validated locally.",
      "Business reviews require cryptographic proof of physical presence via signed QR codes.",
      "Traffic data is passively generated by the NavigationService."
    ]
  },

  "implementation_tasks": {
    "TASK_1_CORE_TYPES": {
      "description": "Define the core TypeScript interfaces and the createAndSignReport function.",
      "action": "Create a file at `src/services/geo/GeoBroadcastTypes.ts`. Implement the SignedGeoReport interface and the three data payload interfaces (HazardData, TrafficData, ReviewData). Include the createAndSignReport function skeleton.",
      "verification": "Show the complete code for this file."
    },

    "TASK_2_GOSSIPSUB_SETUP": {
      "description": "Set up the libp2p Gossipsub topics and broadcast/Listen functions.",
      "action": "Modify `src/services/LibP2PService.ts`. After the node starts, configure it to join the three topics: `/g3zkp/geo/hazard/v1`, `/g3zkp/geo/traffic/v1`, `/g3zkp/business/review/v1`. Implement a `broadcastGeoReport(report)` function that publishes to the correct topic. Implement a listener that receives reports, verifies them, and passes valid ones to a new store.",
      "verification": "Show the diff for the updated LibP2PService.ts, highlighting the new topic configuration and functions."
    },

    "TASK_3_VALIDATION_STORE": {
      "description": "Create the validation logic and in-memory store for received reports.",
      "action": "Create `src/services/geo/GeoValidationService.ts`. Implement: 1) The `verifyAndProcessReport` function with signature verification. 2) Type-specific validators (stub functions for now). 3) A simple in-memory store (Map) to hold recent validated reports by type and location.",
      "verification": "Show the complete code for this file."
    },

    "TASK_4_HAZARD_UI_INTEGRATION": {
      "description": "Connect the Hazard Report button to the P2P system.",
      "action": "Find the hazard reporting UI component (likely in NavigationService). Replace its submit logic to call `createAndSignReport('HAZARD', location, data, privateKey)` and then `broadcastGeoReport(report)`. Ensure it uses the user's libp2p keys.",
      "verification": "Show the updated code snippet for the hazard reporting submit function."
    },

    "TASK_5_TRAFFIC_GENERATION": {
      "description": "Automatically generate traffic speed reports from user movement.",
      "action": "In `src/services/NavigationService.ts`, add logic during active navigation that periodically (e.g., every 30 seconds) takes the current road segment and speed, creates a TRAFFIC_SPEED report, and broadcasts it. Throttle to avoid flooding.",
      "verification": "Show the code snippet added to NavigationService.ts for passive traffic reporting."
    },

    "TASK_6_QR_REVIEW_SYSTEM": {
      "description": "Implement the QR code generation for businesses and the proof validation for reviews.",
      "action": "Create two files: 1) `src/services/business/QrReviewService.ts` with functions for businesses to `generateSignedQrCode()` and for customers to `validateQrCodeAndCreateReview(qrData, rating, comment)`. 2) Update the business review UI to require scanning a QR code first.",
      "verification": "Show the core function signatures and the review validation logic from QrReviewService.ts."
    }
  },
  "final_command": "Now, begin execution with TASK_1_CORE_TYPES. Perform the task and provide the verification output."
}